@using Blazored.Toast.Services
@using College.UI.Interfaces
@using College.UI.Models.GradeStudent
@using Model = College.UI.Models
@inject Radzen.DialogService dialogService

<RadzenTemplateForm Data="@AddGradeStudentInput" TItem="GradeStudentInput" Submit="@((GradeStudentInput args) => { AddGradeStudentDataAsync(args); })">
    <RadzenFieldset Text="Información del Estudiante de Grado">
        <RadzenLabel Text="Estudiante" />
        <RadzenDropDown @bind-Value="AddGradeStudentInput.StudentId" TextProperty="FullName" ValueProperty="StudentId" Style="width: 100%;" />

        <RadzenLabel Text="Grado" />
        <RadzenDropDown @bind-Value="AddGradeStudentInput.GradeId" TextProperty="GradeName" ValueProperty="GradeId" Style="width: 100%;" />

        <RadzenLabel Text="Grupo de Sección" />
        <RadzenTextBox @bind-Value="AddGradeStudentInput.SectionGroup" Style="width: 100%;" />

    </RadzenFieldset>

    <RadzenButton Text="Guardar" ButtonStyle="ButtonStyle.Info" Type="Submit" Style="margin-top: 20px;" />
</RadzenTemplateForm>

@code {
    #region Properties
    private GradeStudentInput AddGradeStudentInput = new GradeStudentInput();
    #endregion

    #region Services
    [Inject] private IGradeStudentService _gradeStudentService { get; set; }
    [Inject] private IToastService _toastService { get; set; }
    #endregion

    #region Methods
 

    public async Task AddGradeStudentDataAsync(GradeStudentInput args)
    {
        var confirmed = await dialogService.Confirm($"¿Seguro que quieres agregar este nuevo estudiante al grado?", "Confirmación", new ConfirmOptions { OkButtonText = "Sí", CancelButtonText = "No" });

        if (confirmed == true)
        {
            var result = await _gradeStudentService.AddGradeStudentAsync(AddGradeStudentInput);

            if (!result.IsError)
            {
                _toastService.ShowInfo("El estudiante ha sido agregado correctamente al grado.");
                dialogService.Close(true);
            }
            else
            {
                _toastService.ShowError("Ha ocurrido un error al agregar el estudiante.");
            }
        }
    }
    #endregion
}
